# 生成古诗词

-----------------**编辑于2017-2-22日晚**---------------


## 使用cs231n课程中的深度学习的代码，用RNN做一个简单的生成古诗词的模型。

- 所有的古诗放在poetry文件夹中，每一首诗放在一个文本文件内，文件的命名方式没有要求。文件的内容：

1. 第一行为题目
2. 第二行往后为古诗，每一句占一行  
训练数据的样例如下：  
`file: 静夜思.txt`
```
静夜思  
床前明月光，疑是地上霜。  
举头望明月，低头思故乡。  
```

## 训练的过程及结果在main.ipynb里面
- cn\_utils模块提供了一些工具，包括读取数据，将所有的数据进行编码，将古诗进行编码，将古诗进行解码。

- 一个汉字的编码要占用掉3个字符，所以在读取的时候要保证输入的数据长度一定是3的整数倍

- 汉字的编码从3开始，0为'blk'表示占位符，1为'stt'表示古诗开始，2为'end'表示古诗截止

- 对rnn进行输入的特征暂时定为如下格式：共20个汉字字符（即60个字符），将诗的题目放在最前面，后面用'blk'占位

## 模型效果

- 目前的模型对于训练集中的古诗错误率已经较低了，但是对于自己测试的数据生成效果很不理想


--------------------**编辑于2017-2-23下午**---------------------


-   训练集里面的数据由昨天的7个增加到了今天的14个。

-   训练的时候发现，使用lstm比使用普通的rnn效果要好很多。

-   训练的过程中，一般训练到loss在26左右在训练集上面的表现就还可以了。在40的时候
    连训练集里的数据都没法正确的表示出来。

-   在生成古诗的时候还存在很大问题，古诗生成比昨天的模型要好很多，昨天是乱码，今天
    可以生成一些古诗，但是所谓生成的古诗实属抄袭。分析其原因感觉是因为每首诗的特征值给
    的太不明显了，20个字的特征值只有前面几个字是题目，后面都是一样的。
    **改进的目标是想办法找到更好的生成特征值(feature)的方法**



------------------**编辑于2017--5-08晚上**-------------------------
-   cn\_utils, poetry\_utils里面增加了一些注释，主要是说明变量的类型

-   Poetry类里面增加了一个类，这个类可以比原来方便地提供训练数据

-   用tensorflow重新写了一遍模型。

-   更正了原来一些对rnn理解上的错误：word2vec原来的理解是错的。

-   现在的数据是将古诗进行了切分，一首诗会切成8(Poetry.py中，Poetries类的sample_len定义)个字的小段
    比如一个题目两个字，算上标点及“开始”与”结束“token还有内容一共26个字的古诗，先将标题于内容连接就形成
    了28个字，切分以后就会成为28-8+1个小段，但是由于最后一句话不能当做输入，故输入实际上有20个小段，输出也对应20个小段

-   现在的模型在输入了逗号，句号等以后可以在有一定的背书能力

-   接下来：1.想办法解决一次必须输入八个句子的问题。2.想办法让它能产生完整的古诗。

----------------**编辑于2017-05-30晚上**--------------------------
-   修改了tensorflow代码，将原来的循环来增加词的个数改为tensorflow的接口
    dynamic_rnn来写

-   现在可以生成一首诗了，但是仍然处于抄袭阶段。在生成了几个end之后会出现
    重复的情况。估计是由于训练的时候所有的输入feature都是0造成的

-   接下来：1.将训练集用的feature给修改。完善tensorflow代码，将建模型
    和训练尽量写到类里面
